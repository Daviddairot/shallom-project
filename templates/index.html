{%load static%}
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Sensor Data</title>
  <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src='https://code.jquery.com/jquery-3.4.1.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js'></script>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css'>
  <!-- Include Toastr.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

</head>
<body>
  <header>
    <span>Development of an iot based monitoring and reporting system for smart farming</span>
  </header>
<!-- partial:index.partial.html -->
<div class="bouncing-blobs-container">
  <div class="bouncing-blobs-glass"></div>
  <div class="bouncing-blobs">
    <div class="bouncing-blob bouncing-blob--purple"></div>
    <div class="bouncing-blob bouncing-blob--purple"></div>
    <div class="bouncing-blob bouncing-blob--purple"></div>
    <div class="bouncing-blob bouncing-blob--purple"></div>
    <div class="bouncing-blob bouncing-blob--purple"></div>
    <div class="bouncing-blob bouncing-blob--purple"></div>
    <div class="bouncing-blob bouncing-blob--purple"></div>
    <div class="bouncing-blob bouncing-blob--pink"></div>
  </div>
</div>
<div class="tutorial-link">
  <div class="container" style="  z-index: 1; /* Higher z-index */">
    <div id = "div1" class="content">
        <h1 class="ht">Sensor value</h1>
        <div class="circular-progress">
        <div class="value-container">0&deg;C</div>
        </div>
    </div>
    <div id = "div2" class="content cont" >
      <div class="itemd" stlye = "height:10px;">
        <div class="containerp">
          <div class="bar">
            <div class="progress">
              <div class="progress-bar progress-bar-info" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 80%;">
              </div>
            </div>
            <p id="sensor-value""> smoke level  </p>
          </div>
        </div>
      </div>
      <div class="bar-container item" style="height: 500px;">
        <div class="goal-bar">
          <div class="bar-wrap">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <hr class="bar-line">
            <div
              class="bar yellow" style="transform: translateY(10%);">
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="500px" height="500px" viewBox="0 0 300 500" enable-background="new 0 0 300 500" xml:space="preserve" style="position:absolute;top:0;left:0;animation-name: waveAction; animation-iteration-count: infinite; animation-timing-function: linear; animation-duration: 1.5s; width: 300px; height: 500px; fill: rgb(4, 172, 255);"><path fill="#04ACFF" d="M300,300V2.5c0,0-0.6-0.1-1.1-0.1c0,0-25.5-2.3-40.5-2.4c-15,0-40.6,2.4-40.6,2.4c-12.3,1.1-30.3,1.8-31.9,1.9c-2-0.1-19.7-0.8-32-1.9c0,0-25.8-2.3-40.8-2.4c-15,0-40.8,2.4-40.8,2.4c-12.3,1.1-30.4,1.8-32,1.9c-2-0.1-20-0.8-32.2-1.9c0,0-3.1-0.3-8.1-0.7V500H300z" style="width:300px;height=500px" id="waveShape"></path></svg>
              <div class="bar-info">
                <div class="bar-info-inner"><span class="bar-label">90</span></div>
              </div>
          </div>
        </div>
      </div>
      <!-- partial -->
     </div>
  </div>
</div>
<!-- partial -->
     <!-- Include jQuery library -->
     <script>
      // Define the fetchTempData function to make the AJAX request
      function fetchTempData() {
          $.ajax({
              url: '/temp/',  // Replace with the actual URL of your Django view
              type: 'GET',
              dataType: 'json',
              success: function(data) {
                  // Handle the response data here
                  console.log('Received temperature data:', data);
                  let progressBar = document.querySelector(".circular-progress");
                  let valueContainer = document.querySelector(".value-container");
                  let speed = 50;
  
                  // Use the received data to update progressEndValue
                  let progressEndValue = data.new_value;
  
                  // Initialize progressValue and start the progress animation
                  let progressValue = 0;
                  let progress = setInterval(() => {
                      progressValue++;
                      valueContainer.textContent = `${progressValue}°C`;
                      progressBar.style.background = `conic-gradient(
                          #4d5bf9 ${progressValue * 3.6}deg,
                          #cadcff ${progressValue * 3.6}deg
                      )`;
                      if (progressValue == progressEndValue) {
                          clearInterval(progress);
                      }
                  }, speed);
              },
              error: function(xhr, textStatus, errorThrown) {
                  console.log('Error fetching temperature data:', errorThrown);
              }
          });
      }
  
      // Call fetchTempData initially and then at regular intervals
      fetchTempData(); // Call initially
      setInterval(fetchTempData, 5000); // Call every 5 seconds (adjust interval as needed)
  </script>
  
  
     <script>
        var maxValue = 100; // Set your desired maximum value here
    
        var bar = document.querySelector(".progress-bar");
        var alert = document.querySelector(".alert");
        var valueDisplay = document.getElementById("input-value-display"); // Get the div element
    
        function changeBarFill(inputValue) {
            if (inputValue <= maxValue) {
                var percent = (inputValue / maxValue) * 100;
                bar.style.width = `${percent}%`;
                alert.style.display = "none";
                valueDisplay.innerHTML = `The input value is ${inputValue}`; // Update div content
            } else {
                alert.style.display = "block";
                valueDisplay.innerHTML = ''; // Clear div content if there's an alert
            }
        }
    
        // Call the function initially to set the progress bar and display the input value
    
        // Function to fetch sensor data from the server and update the HTML
        function fetchSensorData() {
            $.ajax({
                url: '/sensor-data/',  // Replace with your actual URL
                type: 'GET',
                success: function(data) {
                    // Update the HTML with the received sensor value
                    $('#sensor-value').text('Value: ' + data.value);

                    if (parseInt(data.value) >= 80) {
                        // Show a popup notification using Toastr.js
                        toastr.options = {
                            "closeButton": true,
                            "positionClass": "toast-top-right"
                        };
                        toastr.error('Smoke level is high! Please take action.');
                      }
    
                    // Update the input value
                    var inputValue = data.value;
    
                    // Call changeBarFill function to update the progress bar
                    changeBarFill(inputValue);
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log('Error fetching sensor data:', errorThrown);
                }
            });
        }
    
        // Fetch sensor data initially when the page loads
        fetchSensorData();
    
        // Periodically fetch sensor data every 5 seconds
        setInterval(fetchSensorData, 5000); // 5000 milliseconds = 5 seconds
    </script>
    <script>
        const MIN_SPEED = 1.5
        const MAX_SPEED = 2.5

        function randomNumber(min, max) {
        return Math.random() * (max - min) + min
        }

        class Blob {
        constructor(el) {
            this.el = el
            const boundingRect = this.el.getBoundingClientRect()
            this.size = boundingRect.width
            this.initialX = randomNumber(0, window.innerWidth - this.size)
            this.initialY = randomNumber(0, window.innerHeight - this.size)
            this.el.style.top = `${this.initialY}px`
            this.el.style.left = `${this.initialX}px`
            this.vx =
            randomNumber(MIN_SPEED, MAX_SPEED) * (Math.random() > 0.5 ? 1 : -1)
            this.vy =
            randomNumber(MIN_SPEED, MAX_SPEED) * (Math.random() > 0.5 ? 1 : -1)
            this.x = this.initialX
            this.y = this.initialY
        }

        update() {
            this.x += this.vx
            this.y += this.vy
            if (this.x >= window.innerWidth - this.size) {
            this.x = window.innerWidth - this.size
            this.vx *= -1
            }
            if (this.y >= window.innerHeight - this.size) {
            this.y = window.innerHeight - this.size
            this.vy *= -1
            }
            if (this.x <= 0) {
            this.x = 0
            this.vx *= -1
            }
            if (this.y <= 0) {
            this.y = 0
            this.vy *= -1
            }
        }

        move() {
            this.el.style.transform = `translate(${this.x - this.initialX}px, ${
            this.y - this.initialY
            }px)`
        }
        }

        function initBlobs() {
        const blobEls = document.querySelectorAll('.bouncing-blob')
        const blobs = Array.from(blobEls).map((blobEl) => new Blob(blobEl))

        function update() {
            requestAnimationFrame(update)
            blobs.forEach((blob) => {
            blob.update()
            blob.move()
            })
        }

        requestAnimationFrame(update)
        }

        initBlobs()



    </script>
    <script>
      $(document).ready(function() {
          // Function to update the value periodically
          function updateValue() {
              $.ajax({
                  url: '/update_value/',  // URL to your Django view
                  type: 'GET',
                  dataType: 'json',
                  success: function(data) {
                      // Update the value inside the <span class="bar-label"> element
                      $('.bar-label').text(data.new_value);
                      // Check if new_value is greater than or equal to 80
                      if (parseInt(data.new_value) >= 80) {
                        // Show a popup notification using Toastr.js
                        toastr.options = {
                            "closeButton": true,
                            "positionClass": "toast-top-right"
                        };
                        toastr.error('Water level is high! Please take action.');
                      }
                  },
                  error: function(xhr, status, error) {
                      console.error('Error:', error);
                  }
              });
          }
      
          // Call the updateValue function initially
          updateValue();
      
          // Set interval to call the updateValue function every 5 seconds (5000 milliseconds)
          setInterval(updateValue, 5000); // Adjust interval as needed
      });
    </script>
    <script>
          function fetchSensorData() {
            $.ajax({
                url: '/sensor-data/',  // Replace with your actual URL
                type: 'GET',
                success: function(data) {
                    // Update the HTML with the received sensor value
                    $('#sensor-value').text('Value: ' + data.new_value);

                    if (parseInt(data.value) >= 80) {
                        // Show a popup notification using Toastr.js
                        toastr.options = {
                            "closeButton": true,
                            "positionClass": "toast-top-right"
                        };
                        toastr.error('tempreture level is high! Please take action.');
                      }
    
                    // Update the input value
                    var inputValue = data.value;
    
                    // Call changeBarFill function to update the progress bar
                    changeBarFill(inputValue);
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log('Error fetching sensor data:', errorThrown);
                }
            });
        }
    </script>

    
  <footer>
    <span>By Shalom</span>
  </footer>

</body>
</html>
